# Beginner's Guide to Implementing Paystack Split Payments

## 1. Introduction
Paystack is a popular African payment gateway that supports advanced features like split payments. Split payments let you distribute a single customer payment across multiple recipients (e.g., your business and partners) automatically. This guide walks you through every step required to implement Paystack's split payment system—from understanding key terms to writing production-ready code. We will use plain language, simple diagrams, and real-world examples to ensure that even beginners can follow along confidently.

---

## 2. How Paystack Split Payments Work
Before writing any code, it is important to understand what happens during a split transaction:

1. **Customer makes a payment** on your platform (web or mobile).
2. **Paystack processes the payment** securely and verifies the transaction.
3. **Paystack allocates funds** according to the split rules you defined. This split is executed automatically before the money reaches your settlement account.
4. **Each recipient receives their share** into their Paystack subaccount. Your business receives the remainder.

![Split Flow](https://user-images.githubusercontent.com/0000000/paystack-split-flow.png) *(optional visualization if documentation allows images)*

Paystack supports two split models:

| Model | Description | Typical Use Case |
|-------|-------------|------------------|
| **Percentage Split** | Each party receives a fixed percentage of the total transaction amount. | Marketplaces, commissions. |
| **Flat Split** | A fixed amount is allocated to one party, and the remainder goes to others. | Handling delivery fees, fixed service charges. |

You can also combine both models for more complex distribution logic.

---

## 3. Prerequisites

1. **A Paystack Business Account** with access to the dashboard (<https://dashboard.paystack.com/>).
2. **API Keys** (Test and Live). You will find these under *Settings → API Keys & Webhooks*.
3. **Programming Environment** (e.g., Node.js/Express, Laravel, Django). In this guide we provide JavaScript (Node.js) examples, but the Paystack API endpoints are RESTful, so you can adapt them to any language.
4. **Basic REST Knowledge**—understanding HTTP methods (GET, POST), headers, and JSON payloads.
5. **HTTPS endpoint** to receive webhook events for transaction verification (you can use tools like ngrok during development).

---

## 4. Key Concepts and Terminology

| Term | Definition |
|------|------------|
| **Merchant** | You—the platform owner collecting payments from customers. |
| **Subaccount** | A Paystack account representing a party that should receive part of the funds (e.g., a vendor). |
| **Split** | A set of rules describing how a transaction amount should be shared. |
| **Split Code** | A unique identifier generated by Paystack for each split configuration. |
| **Transaction Charge** | Paystack’s processing fee (standard is 1.5% + ₦100 in Nigeria). Splits are applied after fees. |
| **Settlement** | The process of Paystack sending funds to bank accounts linked to the merchant and subaccounts. |

---

## 5. High-Level Implementation Steps

1. Create subaccounts for every partner or vendor.
2. Define a split configuration that connects those subaccounts.
3. Collect payments using the split code.
4. Verify each transaction.
5. Reconcile settlements and handle edge cases (refunds, partial settlements).

The next sections cover each step in depth.

---

## 6. Setting Up Subaccounts
Subaccounts are required because Paystack can only settle funds into accounts registered with them. Each partner you want to pay out must provide Know Your Customer (KYC) information.

### 6.1 Gathering Required Information
- Business name and contact details.
- Bank account number and bank code.
- Percentage charge (optional) if you want the subaccount to absorb part of Paystack’s fees.

### 6.2 Creating a Subaccount (via Dashboard)
1. Log in to the Paystack dashboard.
2. Go to **Subaccounts** and click **Create New**.
3. Fill in the required details.
4. Save. Paystack will provide a `subaccount_code` (e.g., `ACCT_gj8i3ygop0pdjh1`).

### 6.3 Creating a Subaccount (via API)
```bash
curl https://api.paystack.co/subaccount \
  -H "Authorization: Bearer YOUR_SECRET_KEY" \
  -H "Content-Type: application/json" \
  -d '{
        "business_name": "Vendor One",
        "bank_code": "058",
        "account_number": "0123456789",
        "percentage_charge": 2.5,
        "description": "Primary marketplace vendor"
      }'
```
The API returns a JSON response containing the new `subaccount_code`. Store this securely in your database because you will need it when creating splits or processing transactions.

---

## 7. Creating Split Configurations
A split tells Paystack how to share funds among the main account and subaccounts.

### 7.1 Understanding Split Parameters
- `name`: A descriptive name for your split (e.g., “Marketplace Commission Split”).
- `type`: `percentage` or `flat`.
- `bearer_type`: Who covers Paystack’s fees (`account`, `subaccount`, `all-proportional`).
- `bearer_subaccount`: The subaccount that will bear the fees if you selected `subaccount`.
- `subaccounts`: An array describing each participant’s share.

### 7.2 Example: Percentage Split (60% / 40%)
```bash
curl https://api.paystack.co/split \
  -H "Authorization: Bearer YOUR_SECRET_KEY" \
  -H "Content-Type: application/json" \
  -d '{
        "name": "Marketplace Commission",
        "type": "percentage",
        "currency": "NGN",
        "subaccounts": [
          {
            "subaccount": "ACCT_vendorA",
            "share": 60
          },
          {
            "subaccount": "ACCT_vendorB",
            "share": 40
          }
        ],
        "bearer_type": "account"
      }'
```
This returns a `split_code` (e.g., `SPL_bx8i1u2e2j`). You use the code when initializing transactions.

### 7.3 Example: Flat Split (₦500 to Delivery Partner)
```bash
curl https://api.paystack.co/split \
  -H "Authorization: Bearer YOUR_SECRET_KEY" \
  -H "Content-Type: application/json" \
  -d '{
        "name": "Delivery Fee Split",
        "type": "flat",
        "currency": "NGN",
        "subaccounts": [
          {
            "subaccount": "ACCT_delivery",
            "share": 500
          }
        ],
        "bearer_type": "all-proportional"
      }'
```
In a flat split, the share is a currency amount. If the transaction amount is lower than the flat share, the split will fail. Always validate order totals in your application.

### 7.4 Updating or Deleting Splits
- **Update**: `PUT /split/{split_id}`
- **Add Subaccount**: `POST /split/{split_id}/subaccount/add`
- **Remove Subaccount**: `POST /split/{split_id}/subaccount/remove`

Paystack will not retroactively adjust past transactions—changes affect only new payments.

---

## 8. Integrating Split Payments in Your Application

### 8.1 Collecting Payment Details
You can initialize a transaction using Paystack’s inline widget, popup, or server-to-server APIs. Regardless of the method, the key requirement for splits is including the `split_code` or `subaccount` parameters in the initialization request.

### 8.2 Sample Flow (Node.js + Express)

#### Step 1: Install Dependencies
```bash
npm install express axios dotenv
```

#### Step 2: Initialize Paystack Helper
```javascript
// paystack.js
import axios from "axios";

const paystackClient = axios.create({
  baseURL: "https://api.paystack.co",
  headers: {
    Authorization: `Bearer ${process.env.PAYSTACK_SECRET_KEY}`,
    "Content-Type": "application/json"
  }
});

export async function initializeTransaction({ email, amount, splitCode, metadata }) {
  const response = await paystackClient.post("/transaction/initialize", {
    email,
    amount: Math.round(amount * 100), // Paystack amounts are in kobo
    split_code: splitCode,
    metadata
  });
  return response.data.data; // contains authorization_url, access_code, reference
}

export async function verifyTransaction(reference) {
  const response = await paystackClient.get(`/transaction/verify/${reference}`);
  return response.data.data;
}
```

#### Step 3: Create Transaction Endpoint
```javascript
// server.js
import express from "express";
import dotenv from "dotenv";
import { initializeTransaction, verifyTransaction } from "./paystack.js";

dotenv.config();
const app = express();
app.use(express.json());

app.post("/api/payments", async (req, res) => {
  try {
    const { email, amount, orderId } = req.body;

    const transaction = await initializeTransaction({
      email,
      amount,
      splitCode: process.env.PAYSTACK_SPLIT_CODE,
      metadata: { orderId }
    });

    res.json({
      authorizationUrl: transaction.authorization_url,
      reference: transaction.reference
    });
  } catch (error) {
    console.error("Paystack init error", error.response?.data || error.message);
    res.status(500).json({ message: "Unable to initiate payment" });
  }
});

app.post("/api/payments/verify", async (req, res) => {
  try {
    const { reference } = req.body;
    const data = await verifyTransaction(reference);

    if (data.status === "success") {
      // TODO: update order status, record payment details
      res.json({ status: "success", data });
    } else {
      res.status(400).json({ status: "failed", data });
    }
  } catch (error) {
    console.error("Paystack verify error", error.response?.data || error.message);
    res.status(500).json({ message: "Verification failed" });
  }
});

app.listen(4000, () => console.log("Server running on port 4000"));
```

### 8.3 Passing Split Information
There are two ways to pass split information when initializing a transaction:

1. **`split_code`**: Use when you have created a split configuration that involves multiple subaccounts.
2. **`subaccount` + `transaction_charge`**: Use when the transaction only involves a single subaccount receiving a portion of the funds.

For complex scenarios with more than one recipient, always use `split_code`.

---

## 9. Verifying and Recording Transactions

### 9.1 Why Verification Matters
Never mark an order as paid based solely on a customer’s front-end response. Always confirm with Paystack that the payment succeeded.

### 9.2 Using Webhooks
Set up a webhook URL in your Paystack dashboard. When a transaction succeeds, Paystack sends a POST request with event data:

```json
{
  "event": "charge.success",
  "data": {
    "id": 123456789,
    "status": "success",
    "amount": 500000,
    "currency": "NGN",
    "reference": "MPY_kwoijv63l",
    "split": {
      "type": "percentage",
      "split_code": "SPL_98wg1g...",
      "subaccounts": [
        {
          "subaccount": "ACCT_vendorA",
          "share": 60,
          "amount": 300000
        },
        {
          "subaccount": "ACCT_vendorB",
          "share": 40,
          "amount": 200000
        }
      ]
    }
  }
}
```

Your webhook handler should:
1. Verify the event by re-fetching the transaction (`GET /transaction/verify/:reference`).
2. Update your database with the payment status and the amounts allocated to each party.
3. Handle idempotency—ensure repeated webhook deliveries don’t duplicate records.

### 9.3 Database Schema Tips
- **Transactions Table**: store reference, status, customer ID, total amount.
- **SplitAllocations Table**: reference, subaccount_code, allocated_amount.
- **Audit Logs**: track when records are created/updated and by which process.

---

## 10. Managing Settlements and Reconciliation

### 10.1 Understanding Settlement Timing
Paystack settles funds into bank accounts on a schedule (usually next business day for NGN). Each subaccount receives its own settlement transfers.

### 10.2 Reconciling Payouts
- Download settlement reports from the Paystack dashboard.
- Cross-reference transaction references and amounts with your database.
- Automate reconciliation by consuming Paystack’s Settlements API (`GET /settlement`) if needed.

### 10.3 Handling Disputes or Chargebacks
If a customer disputes a charge, Paystack may reverse part or all of the transaction. Ensure your system can roll back split allocations and notify partners.

---

## 11. Testing Strategy

### 11.1 Sandbox vs. Live Keys
- **Test Mode**: Use the default test cards (e.g., `4084 0840 8408 4081`) and test bank accounts to simulate payments.
- **Live Mode**: Switch to live keys only after fully testing your integration.

### 11.2 Simulating Split Scenarios
1. Create test subaccounts in the dashboard.
2. Create a split with those subaccounts.
3. Initialize transactions in test mode using the split code.
4. Verify the amounts returned in webhook payloads or verification responses.

### 11.3 Automation Ideas
- Unit tests for verifying transaction signatures and API responses.
- Integration tests that mock Paystack API using tools like nock (Node.js) or responses (Python).

---

## 12. Security Best Practices

1. **Protect API Keys**: Use environment variables, secrets managers, or encrypted configuration files.
2. **Validate Webhooks**: Confirm Paystack’s `x-paystack-signature` header to ensure the request is genuine.
3. **Use HTTPS**: Never expose payment endpoints over HTTP.
4. **Least Privilege Access**: Only share dashboard access with trusted team members.
5. **Monitor Logs**: Track failed transactions, split mismatches, and unusual patterns.

---

## 13. Handling Advanced Use Cases

### 13.1 Dynamic Split Adjustment per Transaction
If you need to adjust split percentages per transaction (e.g., different vendors have different commission rates), create multiple split configurations and store their codes. Choose the appropriate split code during transaction initialization.

### 13.2 Adding Taxes or Service Fees
- Add tax or service fee line items to the order total before passing the amount to Paystack.
- If taxes or fees belong to different parties, include them in the split configuration.

### 13.3 Supporting Refunds
Use `POST /refund` with the transaction reference or ID. Paystack reverses funds to the customer, and the deduction is reflected in settlements. Update your records accordingly and notify affected subaccounts.

### 13.4 Migrating Existing Systems
If you already have a payment solution:
1. Create subaccounts for existing partners.
2. Map old partner IDs to Paystack subaccount codes.
3. Gradually roll out split payments—start with a subset of transactions.

---

## 14. Troubleshooting Common Errors

| Error Message | Likely Cause | Fix |
|---------------|-------------|-----|
| `Split code not found` | Wrong `split_code` or using a test code in live mode. | Confirm the code matches the environment. |
| `Subaccount does not exist` | Subaccount code typo or deleted subaccount. | Recreate the subaccount and update references. |
| `Amount is less than split share` | Flat share exceeds transaction amount. | Validate order totals before initializing payment. |
| `The transaction is not verified` | Verification endpoint returns failure. | Retry verification or contact Paystack support. |
| Webhook signature mismatch | Incorrect secret or tampered payload. | Recalculate signature using your test key. |

---

## 15. Operational Checklist for Production Launch

1. ✅ All required subaccounts created and verified.
2. ✅ Split configurations tested for all scenarios (percentage, flat, mixed).
3. ✅ Webhook endpoint deployed with HTTPS and signature verification.
4. ✅ Database models created for transactions and split allocations.
5. ✅ Monitoring and alerting configured for failed payments.
6. ✅ Reconciliation process defined with settlement reports.
7. ✅ Team documentation updated for support staff.
8. ✅ Live secret key stored securely.

---

## 16. Frequently Asked Questions (FAQ)

**Q1: Can I split payments across different currencies?**
> No. Splits occur only within the same currency as the transaction.

**Q2: How many subaccounts can I include in a split?**
> Paystack allows up to 10 subaccounts per split.

**Q3: Can the split percentage change after creating the split?**
> Yes, you can update split shares, but changes affect only future transactions.

**Q4: Can I delay payouts to partners?**
> Splits settle automatically. If you need to hold funds, collect the full amount and handle payouts manually.

**Q5: Do subaccounts need their own Paystack dashboard?**
> Yes. Each subaccount has its own settlement profile and can log into Paystack (with limited permissions) to view settlements.

---

## 17. Useful Resources
- Paystack API Reference: <https://paystack.com/docs/api>
- Split Payments Guide: <https://paystack.com/docs/payments/split-payments>
- Paystack Dashboard: <https://dashboard.paystack.com/>
- Webhook Testing (ngrok): <https://ngrok.com/>
- Paystack Support: <https://paystack.com/contact>

---

## 18. Next Steps
- **Prototype**: Build a proof of concept in test mode.
- **Integrate**: Connect to your live system with robust error handling.
- **Document**: Share this guide internally so team members can understand the workflow.
- **Scale**: Automate reconciliation, add reporting dashboards, and track partner performance using the split data.

---

## 19. Summary
By now you should understand how to:
1. Create Paystack subaccounts for all payout recipients.
2. Configure splits (percentage or flat) using the dashboard or API.
3. Initialize transactions with split codes.
4. Verify payments and record split allocations in your database.
5. Reconcile settlements and handle advanced scenarios like refunds or dynamic splits.

Splits transform Paystack from a simple payment processor into a powerful marketplace engine. With careful setup, you can automate payouts, maintain accurate financial records, and give your partners full transparency into their earnings. Take time to test thoroughly, secure your integration, and document every step—doing so ensures a smooth experience for both customers and stakeholders.

---

Happy building!
