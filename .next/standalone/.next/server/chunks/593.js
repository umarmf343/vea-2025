"use strict";exports.id=593,exports.ids=[593],exports.modules={4985:(e,t,s)=>{s.d(t,{CX:()=>l,O9:()=>m,QS:()=>u});var a=s(7491);let n=null,r=null;try{n=s(2418);class e{constructor(){this.pool=null,this.initializePool()}initializePool(){n&&process.env.DATABASE_URL&&(this.pool=n.createPool({uri:process.env.DATABASE_URL,waitForConnections:!0,connectionLimit:10,queueLimit:0,acquireTimeout:6e4,timeout:6e4}))}async query(e,t=[]){if(!this.pool)throw Error("Database not initialized");try{let[s]=await this.pool.execute(e,t);return s}catch(e){throw console.error("[v0] Database query error:",e),e}}async close(){this.pool&&await this.pool.end()}}r=e}catch(e){console.warn("[v0] MySQL2 not available, using fallback storage")}class i{constructor(){this.listeners=new Map,this.connector=null,r&&(this.connector=new r)}addEventListener(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}removeEventListener(e,t){let s=this.listeners.get(e);if(s){let e=s.indexOf(t);e>-1&&s.splice(e,1)}}notifyListeners(e,t){let s=this.listeners.get(e);s&&s.forEach(e=>e(t))}async saveData(e,t){try{this.connector&&("users"===e?await this.saveUsers(t):"students"===e&&await this.saveStudents(t)),a.w.setItem(e,JSON.stringify(t)),this.notifyListeners(e,t)}catch(s){console.error("[v0] Error saving data:",s),a.w.setItem(e,JSON.stringify(t))}}async getData(e){try{if(this.connector){if("users"===e)return await this.getUsers();if("students"===e)return await this.getStudents()}let t=a.w.getItem(e);return t?JSON.parse(t):null}catch(s){console.error("[v0] Error getting data:",s);let t=a.w.getItem(e);return t?JSON.parse(t):null}}async saveUsers(e){if(this.connector)for(let t of e)await this.connector.query(`INSERT INTO users (id, name, email, role, password, class_id, student_id, created_at, updated_at) 
         VALUES (?, ?, ?, ?, ?, ?, ?, NOW(), NOW()) 
         ON DUPLICATE KEY UPDATE 
         name = VALUES(name), email = VALUES(email), role = VALUES(role), 
         password = VALUES(password), class_id = VALUES(class_id), 
         student_id = VALUES(student_id), updated_at = NOW()`,[t.id,t.name,t.email,t.role,t.passwordHash,t.class,t.studentIds?.[0]])}async getUsers(){return this.connector?(await this.connector.query("SELECT * FROM users")).map(e=>({id:e.id.toString(),name:e.name,email:e.email,role:e.role,passwordHash:e.password,class:e.class_id,subjects:e.subjects?JSON.parse(e.subjects):void 0,parentId:e.parent_id,studentIds:e.student_id?[e.student_id]:void 0})):[]}async saveStudents(e){if(this.connector)for(let t of e)await this.connector.query(`INSERT INTO students (id, student_id, name, class_id, parent_email, created_at) 
         VALUES (?, ?, ?, ?, ?, NOW()) 
         ON DUPLICATE KEY UPDATE 
         name = VALUES(name), class_id = VALUES(class_id), parent_email = VALUES(parent_email)`,[t.id,t.admissionNumber,t.name,t.class,t.email])}async getStudents(){return this.connector?(await this.connector.query("SELECT * FROM students")).map(e=>({id:e.id.toString(),name:e.name,email:e.parent_email,class:e.class_id,admissionNumber:e.student_id,parentId:e.parent_email})):[]}}let d=new i,o={students:{findMany:async e=>{let t=d.getData("students")||[{id:"1",name:"John Doe",email:"john@student.vea.edu.ng",class:"JSS 1A",admissionNumber:"VEA/2024/001",parentId:"parent1"},{id:"2",name:"Jane Smith",email:"jane@student.vea.edu.ng",class:"JSS 1A",admissionNumber:"VEA/2024/002",parentId:"parent2"},{id:"3",name:"Mike Johnson",email:"mike@student.vea.edu.ng",class:"JSS 1A",admissionNumber:"VEA/2024/003",parentId:"parent3"}];return e?.class?t.filter(t=>t.class===e.class):t},findById:async e=>(await o.students.findMany()).find(t=>t.id===e)||null,create:async e=>{let t=await o.students.findMany(),s={id:Date.now().toString(),...e};return t.push(s),d.saveData("students",t),s},update:async(e,t)=>{let s=await o.students.findMany(),a=s.findIndex(t=>t.id===e);if(a>-1)return s[a]={...s[a],...t},d.saveData("students",s),s[a];throw Error("Student not found")}},grades:{findMany:async e=>{let t=d.getData("grades")||[{id:"1",studentId:"1",subject:"Mathematics",firstCA:15,secondCA:18,assignment:8,exam:65,total:106,grade:"A",teacherRemarks:"Excellent performance",term:"First Term",session:"2024/2025"}];return e?.studentId&&(t=t.filter(t=>t.studentId===e.studentId)),e?.class,t},create:async e=>{let t=await o.grades.findMany(),s=e.firstCA+e.secondCA+e.assignment+e.exam,a=c(s),n={id:Date.now().toString(),...e,total:s,grade:a};return t.push(n),d.saveData("grades",t),n},update:async(e,t)=>{let s=await o.grades.findMany(),a=s.findIndex(t=>t.id===e);if(a>-1){let e={...s[a],...t};return e.total=e.firstCA+e.secondCA+e.assignment+e.exam,e.grade=c(e.total),s[a]=e,d.saveData("grades",s),e}throw Error("Grade not found")}},assignments:{findMany:async e=>{let t=d.getData("assignments")||[{id:"1",title:"Mathematics Assignment 1",description:"Solve algebraic equations",subject:"Mathematics",class:"JSS 1A",teacherId:"teacher1",dueDate:"2024-12-31",status:"active",submissions:[]}];return e?.class&&(t=t.filter(t=>t.class===e.class)),e?.teacherId&&(t=t.filter(t=>t.teacherId===e.teacherId)),t},create:async e=>{let t=await o.assignments.findMany(),s={id:Date.now().toString(),...e,submissions:[]};return t.push(s),d.saveData("assignments",t),s}},studentMarks:{findMany:async e=>{let t=d.getData("studentMarks")||[{id:"1",studentId:"1",subject:"Mathematics",ca1:15,ca2:18,assignment:8,exam:45,caTotal:41,grandTotal:86,percentage:86,grade:"A",remarks:"Excellent performance in Mathematics",term:"First Term",session:"2024/2025",teacherId:"teacher1",updatedAt:new Date().toISOString()},{id:"2",studentId:"1",subject:"English Language",ca1:12,ca2:16,assignment:7,exam:42,caTotal:35,grandTotal:77,percentage:77,grade:"A",remarks:"Good progress in English",term:"First Term",session:"2024/2025",teacherId:"teacher2",updatedAt:new Date().toISOString()},{id:"3",studentId:"1",subject:"Basic Science",ca1:14,ca2:15,assignment:9,exam:38,caTotal:38,grandTotal:76,percentage:76,grade:"A",remarks:"Shows good understanding of concepts",term:"First Term",session:"2024/2025",teacherId:"teacher3",updatedAt:new Date().toISOString()}];return e?.studentId&&(t=t.filter(t=>t.studentId===e.studentId)),e?.term&&(t=t.filter(t=>t.term===e.term)),e?.session&&(t=t.filter(t=>t.session===e.session)),t},create:async e=>{let t=await o.studentMarks.findMany(),s={id:Date.now().toString(),...e};return t.push(s),d.saveData("studentMarks",t),s}},behavioralAssessments:{findMany:async e=>{let t=Object.values(d.getData("behavioralAssessments")||{});return e?.studentId&&(t=t.filter(t=>t.studentId===e.studentId)),e?.term&&(t=t.filter(t=>t.term===e.term)),e?.session&&(t=t.filter(t=>t.session===e.session)),t},create:async e=>{let t=d.getData("behavioralAssessments")||{},s={id:Date.now().toString(),...e};return t[`${e.studentId}-${e.term}-${e.session}`]=s,d.saveData("behavioralAssessments",t),s}},attendanceRecords:{findMany:async e=>{let t=Object.values(d.getData("attendancePositions")||{});return e?.studentId&&(t=t.filter(t=>t.studentId===e.studentId)),e?.term&&(t=t.filter(t=>t.term===e.term)),e?.session&&(t=t.filter(t=>t.session===e.session)),t},create:async e=>{let t=d.getData("attendancePositions")||{},s={id:Date.now().toString(),...e};return t[`${e.studentId}-${e.term}-${e.session}`]=s,d.saveData("attendancePositions",t),s}},classTeacherRemarks:{findMany:async e=>{let t=Object.values(d.getData("classTeacherRemarks")||{});return e?.studentId&&(t=t.filter(t=>t.studentId===e.studentId)),e?.term&&(t=t.filter(t=>t.term===e.term)),e?.session&&(t=t.filter(t=>t.session===e.session)),t},create:async e=>{let t=d.getData("classTeacherRemarks")||{},s={id:Date.now().toString(),...e};return t[`${e.studentId}-${e.term}-${e.session}`]=s,d.saveData("classTeacherRemarks",t),s}}};function c(e){return e>=75?"A":e>=60?"B":e>=50?"C":e>=40?"D":e>=30?"E":"F"}let l=async e=>[{id:"1",name:"Super Admin",email:"superadmin@vea.edu.ng",role:"Super Admin",passwordHash:"$2a$12$hashedpassword"},{id:"2",name:"Admin User",email:"admin@vea.edu.ng",role:"Admin",passwordHash:"$2a$12$hashedpassword"},{id:"3",name:"Teacher User",email:"teacher@vea.edu.ng",role:"Teacher",passwordHash:"$2a$12$hashedpassword",subjects:["Mathematics","Physics"]},{id:"4",name:"Student User",email:"student@vea.edu.ng",role:"Student",passwordHash:"$2a$12$hashedpassword",class:"JSS 1A"},{id:"5",name:"Parent User",email:"parent@vea.edu.ng",role:"Parent",passwordHash:"$2a$12$hashedpassword",studentIds:["4"]}].find(t=>t.email===e)||null,u=async e=>await o.studentMarks.create(e),m=async(e,t,s)=>{let a={studentId:e};return t&&(a.term=t),s&&(a.session=s),await o.studentMarks.findMany(a)}},7491:(e,t,s)=>{s.d(t,{w:()=>a});let a={getItem:()=>null,setItem:()=>{},removeItem:()=>{}}},8156:(e,t,s)=>{s.d(t,{Fs:()=>l,Gv:()=>i,N1:()=>c,RA:()=>d,WX:()=>o});var a=s(3981),n=s(7390),r=s.n(n);s(6033),s(4770);let i=async(e,t)=>await a.ZP.compare(e,t),d=e=>r().sign(e,process.env.JWT_SECRET,{expiresIn:"24h"}),o=e=>{try{return r().verify(e,process.env.JWT_SECRET)}catch(e){throw Error("Invalid token")}},c=e=>e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").trim(),l=(e,t)=>{let s={"Super Admin":7,Admin:6,Teacher:5,Accountant:4,Librarian:3,Parent:2,Student:1};return(s[e]||0)>=Math.max(...t.map(e=>s[e]||0))}}};