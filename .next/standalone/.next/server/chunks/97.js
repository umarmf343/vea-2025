"use strict";exports.id=97,exports.ids=[97],exports.modules={2097:(e,t,r)=>{r.d(t,{hY:()=>n});var a=r(7491);class s{constructor(){this.listeners=new Map,this.eventListeners=new Map,this.storageArea=a.w}static getInstance(){return s.instance||(s.instance=new s),s.instance}addEventListener(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}removeEventListener(e,t){if(t){let r=this.listeners.get(e);if(r){let e=r.indexOf(t);e>-1&&r.splice(e,1)}}else this.listeners.delete(e)}removeAllEventListeners(){this.listeners.clear()}on(e,t){this.addEventListener(e,t)}off(e,t){this.removeEventListener(e,t)}emit(e,t){this.triggerEvent(e,t)}triggerEvent(e,t){this.notifyListeners(e,t)}notifyListeners(e,t){let r=this.listeners.get(e);r&&r.forEach(e=>e(t))}getData(e){let t=a.w.getItem(e);return t?JSON.parse(t):[]}setData(e,t){a.w.setItem(e,JSON.stringify(t))}getFeeCollection(){let e=a.w.getItem("feeCollection");return e?JSON.parse(e):[]}getClassWiseCollection(){let e=a.w.getItem("classWiseCollection");return e?JSON.parse(e):[]}getExpenseTracking(){let e=a.w.getItem("expenseTracking");return e?JSON.parse(e):[]}async getFeeCollectionData(e){try{let t=`feeCollection_${e}`,r=a.w.getItem(t);return r?JSON.parse(r):[{month:"Jan",collected:25e5,expected:3e6,percentage:83.3},{month:"Feb",collected:28e5,expected:3e6,percentage:93.3},{month:"Mar",collected:22e5,expected:3e6,percentage:73.3},{month:"Apr",collected:29e5,expected:3e6,percentage:96.7}]}catch(e){return console.error("Error getting fee collection data:",e),[]}}async getClassWiseCollection(e,t){try{let r=`classCollection_${e}`,s=a.w.getItem(r),n=s?JSON.parse(s):[{class:"JSS 1",collected:85e4,expected:9e5,students:45,percentage:94.4},{class:"JSS 2",collected:78e4,expected:9e5,students:42,percentage:86.7},{class:"JSS 3",collected:92e4,expected:95e4,students:48,percentage:96.8},{class:"SS 1",collected:12e5,expected:13e5,students:38,percentage:92.3},{class:"SS 2",collected:11e5,expected:12e5,students:35,percentage:91.7},{class:"SS 3",collected:98e4,expected:11e5,students:32,percentage:89.1}];return t&&"all"!==t&&(n=n.filter(e=>e.class===t)),n}catch(e){return console.error("Error getting class-wise collection:",e),[]}}async getExpenseData(e){try{let t=`expenses_${e}`,r=a.w.getItem(t);return r?JSON.parse(r):[{category:"Staff Salaries",amount:15e5,percentage:45},{category:"Utilities",amount:3e5,percentage:9},{category:"Maintenance",amount:2e5,percentage:6},{category:"Supplies",amount:4e5,percentage:12},{category:"Transport",amount:25e4,percentage:7.5},{category:"Others",amount:683333,percentage:20.5}]}catch(e){return console.error("Error getting expense data:",e),[]}}async getFeeDefaulters(){let e=a.w.getItem("feeDefaulters");return e?JSON.parse(e):[]}async getFinancialSummary(e){try{let t=`financialSummary_${e}`,r=a.w.getItem(t);return r?JSON.parse(r):{totalCollected:104e5,collectionRate:87.3,studentsPaid:240,defaultersCount:15,outstandingAmount:15e5,avgCollectionTime:15,onTimePaymentRate:94.2}}catch(e){return console.error("Error getting financial summary:",e),{totalCollected:0,collectionRate:0,studentsPaid:0,defaultersCount:0,outstandingAmount:0,avgCollectionTime:0,onTimePaymentRate:0}}}getFinancialSummary(){let e=a.w.getItem("financialSummary");return e?JSON.parse(e):{}}async saveFinancialReport(e){try{let t=await this.getAllFinancialReports(),r={...e,id:Date.now().toString(),createdAt:new Date().toISOString()};return t.push(r),a.w.setItem("financialReports",JSON.stringify(t)),this.triggerEvent("financialReportSaved",r),r}catch(e){throw console.error("Error saving financial report:",e),e}}saveFinancialReport(e){let t=this.getFinancialReports();t.push({...e,id:Date.now().toString(),createdAt:new Date().toISOString()}),a.w.setItem("financialReports",JSON.stringify(t)),this.emit("financialReportSaved",e)}async getAllFinancialReports(){let e=a.w.getItem("financialReports");return e?JSON.parse(e):[]}getFinancialReports(){let e=a.w.getItem("financialReports");return e?JSON.parse(e):[]}async sendPaymentReminder(e){try{let t=(await this.getFeeDefaulters()).find(t=>t.id===e);if(t){let r={id:Date.now().toString(),defaulterId:e,type:"payment_reminder",message:`Payment reminder sent to ${t.name} for outstanding amount of â‚¦${t.amount.toLocaleString()}`,sentAt:new Date().toISOString()};return await this.saveNotification({title:"Payment Reminder Sent",message:r.message,type:"financial",targetAudience:["admin","accountant"]}),this.triggerEvent("paymentReminderSent",r),r}throw Error("Defaulter not found")}catch(e){throw console.error("Error sending payment reminder:",e),e}}async contactParent(e){try{let t=(await this.getFeeDefaulters()).find(t=>t.id===e);if(t){let r={id:Date.now().toString(),defaulterId:e,type:"parent_contact",message:`Parent contact initiated for ${t.name} regarding outstanding fees`,contactedAt:new Date().toISOString()};return await this.saveNotification({title:"Parent Contacted",message:r.message,type:"financial",targetAudience:["admin","accountant"]}),this.triggerEvent("parentContacted",r),r}throw Error("Defaulter not found")}catch(e){throw console.error("Error contacting parent:",e),e}}async updateFeeCollection(e,t){try{let r=`feeCollection_${e}`;return a.w.setItem(r,JSON.stringify(t)),this.triggerEvent("financialDataUpdated",{period:e,type:"feeCollection",data:t}),t}catch(e){throw console.error("Error updating fee collection:",e),e}}async addExpense(e,t){try{let r=await this.getExpenseData(e),s={...t,id:Date.now().toString(),addedAt:new Date().toISOString()};r.push(s);let n=`expenses_${e}`;return a.w.setItem(n,JSON.stringify(r)),this.triggerEvent("expenseAdded",{period:e,expense:s}),s}catch(e){throw console.error("Error adding expense:",e),e}}async saveUser(e){try{let t=await this.getAllUsers(),r=t.findIndex(t=>t.id===e.id);return r>=0?t[r]={...t[r],...e,updatedAt:new Date().toISOString()}:t.push({...e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),a.w.setItem("users",JSON.stringify(t)),this.triggerEvent("userUpdated",e),e}catch(e){throw console.error("Error saving user:",e),e}}async deleteUser(e){try{let t=(await this.getAllUsers()).filter(t=>t.id!==e);return a.w.setItem("users",JSON.stringify(t)),this.triggerEvent("userDeleted",{userId:e}),!0}catch(e){throw console.error("Error deleting user:",e),e}}async getAllUsers(){let e=a.w.getItem("users");return e?JSON.parse(e):[{id:1,name:"John Doe",email:"john@vea.edu.ng",role:"Student",status:"Active",lastLogin:"2024-03-10",class:"JSS 1A",admissionNo:"VEA2025001"},{id:2,name:"Jane Smith",email:"jane@vea.edu.ng",role:"Teacher",status:"Active",lastLogin:"2024-03-10",subjects:["Mathematics","Physics"]},{id:3,name:"Mike Johnson",email:"mike@vea.edu.ng",role:"Parent",status:"Active",lastLogin:"2024-03-09",children:[1]}]}createUser(e){let t=this.getUsers(),r={...e,id:Date.now().toString(),createdAt:new Date().toISOString()};t.push(r),a.w.setItem("users",JSON.stringify(t)),this.emit("userCreated",r)}updateUser(e,t){let r=this.getUsers(),s=r.findIndex(t=>t.id===e);-1!==s&&(r[s]={...r[s],...t,updatedAt:new Date().toISOString()},a.w.setItem("users",JSON.stringify(r)),this.emit("userUpdated",r[s]))}deleteUser(e){let t=this.getUsers().filter(t=>t.id!==e);a.w.setItem("users",JSON.stringify(t)),this.emit("userDeleted",e)}getUsers(){let e=a.w.getItem("users");return e?JSON.parse(e):[]}async saveBranding(e){try{let t={...e,updatedAt:new Date().toISOString(),version:Date.now()};return a.w.setItem("schoolBranding",JSON.stringify(t)),this.triggerEvent("brandingUpdated",t),t}catch(e){throw console.error("Error saving branding:",e),e}}saveBranding(e){let t={...e,updatedAt:new Date().toISOString()};a.w.setItem("schoolBranding",JSON.stringify(t)),this.emit("brandingUpdated",t)}async getBranding(){try{let e=a.w.getItem("schoolBranding");return e?JSON.parse(e):{schoolLogo:null,headmasterSignature:null,headmasterName:"Dr. Emmanuel Adebayo",defaultRemark:"Keep up the excellent work and continue to strive for academic excellence.",logoUrl:"",signatureUrl:""}}catch(e){return console.error("Error getting branding:",e),null}}getBranding(){let e=a.w.getItem("schoolBranding");return e?JSON.parse(e):{}}async saveReportCard(e){try{let t=await this.getAllReportCards(),r=t.findIndex(t=>t.studentId===e.studentId),s={...e,updatedAt:new Date().toISOString(),version:Date.now()};return r>=0?t[r]=s:t.push(s),a.w.setItem("reportCards",JSON.stringify(t)),this.triggerEvent("reportCardUpdated",s),s}catch(e){throw console.error("Error saving report card:",e),e}}saveReportCard(e){let t=this.getReportCards(),r=t.findIndex(t=>t.studentId===e.studentId&&t.term===e.term);-1!==r?t[r]={...t[r],...e}:t.push({...e,id:Date.now().toString()}),a.w.setItem("reportCards",JSON.stringify(t)),this.emit("reportCardSaved",e)}async getAllReportCards(){let e=a.w.getItem("reportCards");return e?JSON.parse(e):[]}getReportCards(){let e=a.w.getItem("reportCards");return e?JSON.parse(e):[]}async getReportCard(e){return(await this.getAllReportCards()).find(t=>t.studentId===e)||null}async getSystemHealth(){return{database:"healthy",paymentGateway:"online",emailService:"active",cpuUsage:Math.floor(30*Math.random())+40,memoryUsage:Math.floor(20*Math.random())+50,uptime:"99.9%",lastChecked:new Date().toISOString()}}async saveTeacherData(e,t,r){try{let s=`teacher_${e}_${t}`,n={...r,teacherId:e,dataType:t,updatedAt:new Date().toISOString(),version:Date.now()};return a.w.setItem(s,JSON.stringify(n)),this.triggerEvent(`teacherDataUpdated_${t}`,{teacherId:e,data:n}),n}catch(e){throw console.error("Error saving teacher data:",e),e}}saveTeacherData(e,t){let r={...t,savedAt:new Date().toISOString()};a.w.setItem(e,JSON.stringify(r)),this.emit("teacherDataSaved",{key:e,data:r})}async getTeacherData(e,t){try{let r=`teacher_${e}_${t}`,s=a.w.getItem(r);return s?JSON.parse(s):null}catch(e){return console.error("Error getting teacher data:",e),null}}getTeacherData(e){let t=a.w.getItem(e);return t?JSON.parse(t):null}async getAllTeacherData(){let e=a.w.getItem("teacherData");return e?JSON.parse(e):{}}getAllTeacherData(){let e=a.w.getItem("teacherData");return e?JSON.parse(e):{}}async saveMessage(e){try{let t=await this.getAllMessages(),r={...e,id:Date.now().toString(),timestamp:new Date().toISOString(),status:"sent",reactions:[],attachments:e.attachments||[]};return t.push(r),a.w.setItem("messages",JSON.stringify(t)),this.triggerEvent("messageReceived",r),r}catch(e){throw console.error("Error saving message:",e),e}}saveMessage(e){let t=this.getMessages(),r={...e,id:Date.now().toString(),timestamp:new Date().toISOString()};t.push(r),a.w.setItem("messages",JSON.stringify(t)),this.emit("messageSaved",r)}async getAllMessages(){let e=a.w.getItem("messages");return e?JSON.parse(e):[]}getMessages(){let e=a.w.getItem("messages");return e?JSON.parse(e):[]}async getMessagesByConversation(e){return(await this.getAllMessages()).filter(t=>e.every(e=>[t.senderId,t.receiverId].includes(e)))}async saveApprovalStatus(e,t,r,s){try{let n=await this.getAllApprovals(),i=`approval_${e}`;return n[i]={studentId:e,status:t,feedback:r||"",adminId:s||"system",updatedAt:new Date().toISOString(),history:n[i]?.history||[]},n[i].history.push({status:t,feedback:r,adminId:s,timestamp:new Date().toISOString()}),a.w.setItem("reportCardApprovals",JSON.stringify(n)),this.triggerEvent("approvalStatusUpdated",{studentId:e,status:t,feedback:r}),n[i]}catch(e){throw console.error("Error saving approval status:",e),e}}saveApprovalWorkflow(e){let t=this.getApprovalWorkflows();t.push({...e,id:Date.now().toString(),timestamp:new Date().toISOString()}),a.w.setItem("reportCardApprovals",JSON.stringify(t)),this.emit("approvalSaved",e)}async getAllApprovals(){let e=a.w.getItem("reportCardApprovals");return e?JSON.parse(e):{}}getApprovalWorkflows(){let e=a.w.getItem("reportCardApprovals");return e?JSON.parse(e):[]}async getApprovalStatus(e){return(await this.getAllApprovals())[`approval_${e}`]||null}async saveSystemSettings(e){try{let t={...e,updatedAt:new Date().toISOString(),version:Date.now()};return a.w.setItem("systemSettings",JSON.stringify(t)),this.triggerEvent("settingsUpdated",t),t}catch(e){throw console.error("Error saving system settings:",e),e}}saveSystemSettings(e){let t={...e,updatedAt:new Date().toISOString()};a.w.setItem("systemSettings",JSON.stringify(t)),this.emit("systemSettingsUpdated",t)}async getSystemSettings(){try{let e=a.w.getItem("systemSettings");return e?JSON.parse(e):{academicYear:"2024/2025",currentTerm:"First Term",reportCardDeadline:"",schoolName:"Victory Educational Academy",schoolAddress:"No. 19, Abdulazeez Street, Zone 3 Duste Baumpaba, Bwari Area Council, Abuja"}}catch(e){return console.error("Error getting system settings:",e),null}}getSystemSettings(){let e=a.w.getItem("systemSettings");return e?JSON.parse(e):{}}async getAllClasses(){let e=a.w.getItem("classes");return e?JSON.parse(e):["JSS 1A","JSS 1B","JSS 1C","JSS 2A","JSS 2B","JSS 2C","JSS 3A","JSS 3B","JSS 3C","SS 1A","SS 1B","SS 1C","SS 2A","SS 2B","SS 2C","SS 3A","SS 3B","SS 3C"]}getClasses(){let e=a.w.getItem("classes");return e?JSON.parse(e):[{id:"1",name:"JSS1A",students:25,teacher:"Mrs. Johnson"},{id:"2",name:"JSS1B",students:23,teacher:"Mr. Smith"},{id:"3",name:"JSS2A",students:27,teacher:"Mrs. Brown"},{id:"4",name:"JSS2B",students:24,teacher:"Mr. Davis"},{id:"5",name:"JSS3A",students:26,teacher:"Mrs. Wilson"}]}async addClass(e){try{let t=await this.getAllClasses();return t.includes(e)||(t.push(e),a.w.setItem("classes",JSON.stringify(t)),this.triggerEvent("classAdded",{className:e})),t}catch(e){throw console.error("Error adding class:",e),e}}createClass(e){let t=this.getClasses(),r={...e,id:Date.now().toString(),createdAt:new Date().toISOString()};t.push(r),a.w.setItem("classes",JSON.stringify(t)),this.emit("classCreated",r)}async deleteClass(e){try{let t=(await this.getAllClasses()).filter(t=>t!==e);return a.w.setItem("classes",JSON.stringify(t)),this.triggerEvent("classDeleted",{className:e}),t}catch(e){throw console.error("Error deleting class:",e),e}}updateClass(e,t){let r=this.getClasses(),s=r.findIndex(t=>t.id===e);-1!==s&&(r[s]={...r[s],...t,updatedAt:new Date().toISOString()},a.w.setItem("classes",JSON.stringify(r)),this.emit("classUpdated",r[s]))}deleteClass(e){let t=this.getClasses().filter(t=>t.id!==e);a.w.setItem("classes",JSON.stringify(t)),this.emit("classDeleted",e)}async savePayment(e){try{let t=await this.getAllPayments(),r={...e,id:Date.now(),timestamp:new Date().toISOString(),status:"completed"};return t.push(r),a.w.setItem("payments",JSON.stringify(t)),this.triggerEvent("paymentCompleted",r),r}catch(e){throw console.error("Error saving payment:",e),e}}createPayment(e){let t=this.getPayments(),r={...e,id:Date.now().toString(),createdAt:new Date().toISOString()};t.push(r),a.w.setItem("payments",JSON.stringify(t)),this.emit("paymentCreated",r)}async getAllPayments(){let e=a.w.getItem("payments");return e?JSON.parse(e):[]}getPayments(){let e=a.w.getItem("payments");return e?JSON.parse(e):[]}async getPayments(){try{let e=a.w.getItem("payments");return e?JSON.parse(e):[{id:"1",studentName:"John Doe",parentName:"Jane Doe",amount:5e4,status:"paid",method:"online",date:"2025-01-08",reference:"PAY_123456789",hasAccess:!0},{id:"2",studentName:"Alice Smith",parentName:"Bob Smith",amount:5e4,status:"pending",method:"offline",date:"2025-01-07",hasAccess:!1},{id:"3",studentName:"Michael Johnson",parentName:"Sarah Johnson",amount:5e4,status:"failed",method:"online",date:"2025-01-06",reference:"PAY_987654321",hasAccess:!1}]}catch(e){return console.error("Error getting payments:",e),[]}}async updatePaymentAccess(e,t){try{let r=(await this.getPayments()).map(r=>r.id===e?{...r,hasAccess:t,status:t?"paid":r.status}:r);return a.w.setItem("payments",JSON.stringify(r)),this.triggerEvent("paymentsUpdated",r),r.find(t=>t.id===e)}catch(e){throw console.error("Error updating payment access:",e),e}}updatePaymentAccess(e,t){let r=a.w.getItem("payments"),s=r?JSON.parse(r):[],n=s.find(t=>t.studentId===e);n?(n.hasAccess=t,n.updatedAt=new Date().toISOString()):s.push({id:Date.now().toString(),studentId:e,hasAccess:t,createdAt:new Date().toISOString()}),a.w.setItem("payments",JSON.stringify(s)),this.emit("paymentAccessUpdated",{studentId:e,hasAccess:t})}async createPayment(e){try{let t=await this.getPayments(),r={...e,id:Date.now().toString(),date:new Date().toISOString().split("T")[0],hasAccess:"paid"===e.status};return t.push(r),a.w.setItem("payments",JSON.stringify(t)),this.triggerEvent("paymentsUpdated",t),r}catch(e){throw console.error("Error creating payment:",e),e}}updatePaymentStatus(e,t){let r=this.getPayments(),s=r.findIndex(t=>t.id===e);-1!==s&&(r[s]={...r[s],status:t,updatedAt:new Date().toISOString()},a.w.setItem("payments",JSON.stringify(r)),this.emit("paymentStatusUpdated",r[s]))}async updatePaymentStatus(e,t){try{let r=(await this.getPayments()).map(r=>r.id===e?{...r,status:t,hasAccess:"paid"===t}:r);return a.w.setItem("payments",JSON.stringify(r)),this.triggerEvent("paymentsUpdated",r),r.find(t=>t.id===e)}catch(e){throw console.error("Error updating payment status:",e),e}}async saveNotification(e){try{let t=await this.getAllNotifications(),r={...e,id:Date.now().toString(),timestamp:new Date().toISOString(),read:!1};return t.push(r),a.w.setItem("notifications",JSON.stringify(t)),this.triggerEvent("notificationReceived",r),r}catch(e){throw console.error("Error saving notification:",e),e}}createNotification(e){let t=this.getNotifications(),r={...e,id:Date.now().toString(),createdAt:new Date().toISOString()};t.push(r),a.w.setItem("notifications",JSON.stringify(t)),this.emit("notificationCreated",r)}async getAllNotifications(){let e=a.w.getItem("notifications");return e?JSON.parse(e):[]}getNotifications(){let e=a.w.getItem("notifications");return e?JSON.parse(e):[]}async markNotificationAsRead(e){try{let t=await this.getAllNotifications(),r=t.find(t=>t.id===e);return r&&(r.read=!0,a.w.setItem("notifications",JSON.stringify(t)),this.triggerEvent("notificationRead",{notificationId:e})),r}catch(e){throw console.error("Error marking notification as read:",e),e}}markNotificationAsRead(e){let t=this.getNotifications(),r=t.findIndex(t=>t.id===e);-1!==r&&(t[r].read=!0,a.w.setItem("notifications",JSON.stringify(t)),this.emit("notificationRead",t[r]))}async syncData(){try{for(let e of["users","reportCards","messages","approvals","branding","systemSettings","classes","payments","notifications"])this.triggerEvent(`${e}Synced`,{timestamp:new Date().toISOString()});return!0}catch(e){throw console.error("Error syncing data:",e),e}}async validateData(){try{let e={users:await this.validateUsers(),reportCards:await this.validateReportCards(),systemHealth:await this.getSystemHealth()};return this.triggerEvent("dataValidated",e),e}catch(e){throw console.error("Error validating data:",e),e}}async validateUsers(){let e=await this.getAllUsers();return{total:e.length,valid:e.filter(e=>e.name&&e.email&&e.role).length,invalid:e.filter(e=>!e.name||!e.email||!e.role).length}}async validateReportCards(){let e=await this.getAllReportCards();return{total:e.length,valid:e.filter(e=>e.studentId&&e.marks).length,invalid:e.filter(e=>!e.studentId||!e.marks).length}}async getNotices(){let e=a.w.getItem("notices");return e?JSON.parse(e):[]}async createNotice(e){try{let t=await this.getNotices(),r={...e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.unshift(r),a.w.setItem("notices",JSON.stringify(t)),this.triggerEvent("noticeCreated",r),r}catch(e){throw console.error("Error creating notice:",e),e}}getNotices(){let e=a.w.getItem("notices");return e?JSON.parse(e):[]}async updateNotice(e,t){try{let r=await this.getNotices(),s=r.findIndex(t=>t.id===e);if(s>-1)return r[s]={...r[s],...t,updatedAt:new Date().toISOString()},a.w.setItem("notices",JSON.stringify(r)),this.triggerEvent("noticeUpdated",r[s]),r[s];throw Error("Notice not found")}catch(e){throw console.error("Error updating notice:",e),e}}createNotice(e){let t=this.getNotices(),r={...e,id:Date.now().toString(),createdAt:new Date().toISOString()};t.push(r),a.w.setItem("notices",JSON.stringify(t)),this.emit("noticeCreated",r)}updateNotice(e,t){let r=this.getNotices(),s=r.findIndex(t=>t.id===e);-1!==s&&(r[s]={...r[s],...t,updatedAt:new Date().toISOString()},a.w.setItem("notices",JSON.stringify(r)),this.emit("noticeUpdated",r[s]))}async deleteNotice(e){try{let t=(await this.getNotices()).filter(t=>t.id!==e);return a.w.setItem("notices",JSON.stringify(t)),this.triggerEvent("noticeDeleted",{noticeId:e}),!0}catch(e){throw console.error("Error deleting notice:",e),e}}deleteNotice(e){let t=this.getNotices().filter(t=>t.id!==e);a.w.setItem("notices",JSON.stringify(t)),this.emit("noticeDeleted",e)}async getNoticesByAudience(e){try{return(await this.getNotices()).filter(t=>t.targetAudience.includes(e)||"admin"===e)}catch(e){return console.error("Error getting notices by audience:",e),[]}}async getPinnedNotices(e){try{let t=(await this.getNotices()).filter(e=>e.isPinned);return e&&"admin"!==e&&(t=t.filter(t=>t.targetAudience.includes(e))),t}catch(e){return console.error("Error getting pinned notices:",e),[]}}async getAcademicAnalytics(e="current",t="all"){try{let r=await this.getAllTeacherData(),a=await this.getAllReportCards(),s=await this.getAllUsers(),n=this.calculateClassPerformance(r,a,t),i=this.calculateSubjectPerformance(r,t),o=this.calculateTermComparison(r,e),l=this.getTopPerformers(r,a,s,t),c=this.generateRadarData(i),g=this.calculateSummaryStats(n,r);return{classPerformance:n,subjectPerformance:i,termComparison:o,topPerformers:l,performanceRadarData:c,summaryStats:g,generatedAt:new Date().toISOString()}}catch(e){return console.error("Error getting academic analytics:",e),{classPerformance:[],subjectPerformance:[],termComparison:[],topPerformers:[],performanceRadarData:[],summaryStats:{overallAverage:0,totalStudents:0,passRate:0,excellenceRate:0}}}}calculateClassPerformance(e,t,r){let a=new Map;return Object.entries(e).forEach(([e,t])=>{t.marks&&Object.entries(t.marks).forEach(([e,t])=>{let s=this.getStudentClass(e);if("all"===r||this.matchesClassFilter(s,r)){a.has(s)||a.set(s,{scores:[],students:new Set});let r=((t.firstCA||0)+(t.secondCA||0)+(t.noteAssignment||0)+(t.exam||0))/(t.totalObtainable||100)*100;a.get(s).scores.push(r),a.get(s).students.add(e)}})}),Array.from(a.entries()).map(([e,t])=>{let r=t.scores,a=r.length>0?r.reduce((e,t)=>e+t,0)/r.length:0,s=r.length>0?Math.max(...r):0,n=r.length>0?Math.min(...r):0;return{class:e,average:Math.round(10*a)/10,students:t.students.size,topScore:Math.round(s),lowScore:Math.round(n)}})}calculateSubjectPerformance(e,t){let r=new Map;return Object.entries(e).forEach(([e,a])=>{let[s,n]=e.split("-");if(("all"===t||this.matchesClassFilter(s,t))&&a.marks){let e=[];if(Object.values(a.marks).forEach(t=>{let r=((t.firstCA||0)+(t.secondCA||0)+(t.noteAssignment||0)+(t.exam||0))/(t.totalObtainable||100)*100;e.push(r)}),e.length>0){e.reduce((e,t)=>e+t,0),e.length;let t=e.filter(e=>e>=50).length,s=e.filter(e=>e>=80).length;r.has(n)||r.set(n,{subject:n,scores:[],passCount:0,excellentCount:0,totalStudents:0,teacher:a.teacherName||"Unknown"});let i=r.get(n);i.scores.push(...e),i.passCount+=t,i.excellentCount+=s,i.totalStudents+=e.length}}}),Array.from(r.values()).map(e=>({subject:e.subject,average:Math.round(e.scores.reduce((e,t)=>e+t,0)/e.scores.length*10)/10,passRate:Math.round(e.passCount/e.totalStudents*100),excellentRate:Math.round(e.excellentCount/e.totalStudents*100),teacher:e.teacher}))}calculateTermComparison(e,t){let r=this.calculateOverallAverage(e);return[{term:"First Term",average:Math.max(r-5,70),passRate:85,attendance:92},{term:"Second Term",average:Math.max(r-2,75),passRate:88,attendance:89},{term:"Third Term",average:r,passRate:91,attendance:94}]}getTopPerformers(e,t,r,a){let s=new Map;return Object.entries(e).forEach(([e,t])=>{t.marks&&Object.entries(t.marks).forEach(([e,t])=>{let r=this.getStudentClass(e);if("all"===a||this.matchesClassFilter(r,a)){s.has(e)||s.set(e,{scores:[],subjects:0,class:r});let a=((t.firstCA||0)+(t.secondCA||0)+(t.noteAssignment||0)+(t.exam||0))/(t.totalObtainable||100)*100;s.get(e).scores.push(a),s.get(e).subjects++}})}),Array.from(s.entries()).map(([e,t])=>{let a=t.scores.reduce((e,t)=>e+t,0)/t.scores.length,s=r.find(t=>t.id===e);return{name:s?.name||`Student ${e}`,class:t.class,average:Math.round(10*a)/10,subjects:t.subjects}}).sort((e,t)=>t.average-e.average).slice(0,5)}generateRadarData(e){return e.slice(0,6).map(e=>({subject:e.subject,A:e.average,B:Math.max(e.average-5,60)}))}calculateSummaryStats(e,t){let r=e.reduce((e,t)=>e+t.students,0),a=e.length>0?e.reduce((e,t)=>e+t.average*t.students,0)/r:0,s=[];Object.values(t).forEach(e=>{e.marks&&Object.values(e.marks).forEach(e=>{let t=((e.firstCA||0)+(e.secondCA||0)+(e.noteAssignment||0)+(e.exam||0))/(e.totalObtainable||100)*100;s.push(t)})});let n=s.filter(e=>e>=50).length,i=s.filter(e=>e>=80).length;return{overallAverage:Math.round(10*a)/10,totalStudents:r,passRate:Math.round(10*(s.length>0?n/s.length*100:0))/10,excellenceRate:Math.round(10*(s.length>0?i/s.length*100:0))/10}}calculateOverallAverage(e){let t=[];return Object.values(e).forEach(e=>{e.marks&&Object.values(e.marks).forEach(e=>{let r=((e.firstCA||0)+(e.secondCA||0)+(e.noteAssignment||0)+(e.exam||0))/(e.totalObtainable||100)*100;t.push(r)})}),t.length>0?t.reduce((e,t)=>e+t,0)/t.length:0}getStudentClass(e){return({student1:"JSS 1A",student2:"JSS 1B",student3:"JSS 2A",student4:"JSS 2B",student5:"JSS 3A",student6:"SS 1A",student7:"SS 2A",student8:"SS 3A"})[e]||"JSS 1A"}matchesClassFilter(e,t){return"all"===t||({jss1:["JSS 1A","JSS 1B"],jss2:["JSS 2A","JSS 2B"],jss3:["JSS 3A","JSS 3B"],ss1:["SS 1A","SS 1B"],ss2:["SS 2A","SS 2B"],ss3:["SS 3A","SS 3B"]})[t]?.includes(e)||!1}async saveAnalyticsReport(e){try{let t=await this.getAllAnalyticsReports(),r={...e,id:Date.now().toString(),createdAt:new Date().toISOString()};return t.push(r),a.w.setItem("analyticsReports",JSON.stringify(t)),this.triggerEvent("analyticsReportSaved",r),r}catch(e){throw console.error("Error saving analytics report:",e),e}}saveAnalyticsReport(e){let t=this.getAnalyticsReports();t.push({...e,id:Date.now().toString(),createdAt:new Date().toISOString()}),a.w.setItem("analyticsReports",JSON.stringify(t)),this.emit("analyticsReportSaved",e)}async getAllAnalyticsReports(){let e=a.w.getItem("analyticsReports");return e?JSON.parse(e):[]}getAnalyticsReports(){let e=a.w.getItem("analyticsReports");return e?JSON.parse(e):[]}async getStudentsByClass(e){try{return(await this.getAllUsers()).filter(t=>"Student"===t.role&&t.class===e)}catch(e){throw console.error("Error getting students by class:",e),e}}async getStudentAcademicData(e){try{let t=`marks_${e}`,r=a.w.getItem(t);if(!r)return[{subject:"Mathematics",totalPercentage:75},{subject:"English",totalPercentage:82},{subject:"Science",totalPercentage:68},{subject:"Social Studies",totalPercentage:79},{subject:"French",totalPercentage:71}];return JSON.parse(r)}catch(e){throw console.error("Error getting student academic data:",e),e}}async getStudentAttendance(e){try{let t=`attendance_${e}`,r=a.w.getItem(t);if(!r){let e=Math.floor(20*Math.random())+160,r={present:e,total:180,percentage:Math.round(e/180*100),absent:180-e};return a.w.setItem(t,JSON.stringify(r)),r}return JSON.parse(r)}catch(e){throw console.error("Error getting student attendance:",e),e}}getStudentMarks(e,t){let r=`marks_${e}_${t}`,s=a.w.getItem(r);return s?JSON.parse(s):null}async getUpcomingEvents(e){try{let t=`events_${e}`,r=a.w.getItem(t);if(!r){let r=[{id:1,title:"Mathematics Test",date:"March 20, 2024",description:"Chapter 5-7 coverage",type:"exam",class:e},{id:2,title:"Science Fair",date:"March 25, 2024",description:"Present your science projects",type:"event",class:e},{id:3,title:"Parent-Teacher Meeting",date:"March 30, 2024",description:"Discuss student progress",type:"meeting",class:e}];return a.w.setItem(t,JSON.stringify(r)),r}return JSON.parse(r)}catch(e){throw console.error("Error getting upcoming events:",e),e}}async getStudentAttendance(e){let t=`attendance_${e}`,r=a.w.getItem(t);if(!r){let e={present:Math.floor(20*Math.random())+80,total:100,percentage:0};return e.percentage=Math.round(e.present/e.total*100),a.w.setItem(t,JSON.stringify(e)),e}return JSON.parse(r)}async getUpcomingEvents(){let e="upcomingEvents",t=a.w.getItem(e);if(!t){let t=[{id:"1",title:"Mid-Term Examination",date:"2024-02-15",type:"exam"},{id:"2",title:"Parent-Teacher Meeting",date:"2024-02-20",type:"meeting"},{id:"3",title:"Sports Day",date:"2024-02-25",type:"event"}];return a.w.setItem(e,JSON.stringify(t)),t}return JSON.parse(t)}async getStudentProfile(e){try{let t=`profile_${e}`,r=a.w.getItem(t);if(!r)return(await this.getAllUsers()).find(t=>t.id===e)||null;return JSON.parse(r)}catch(e){throw console.error("Error getting student profile:",e),e}}async updateStudentProfile(e,t){try{let r=`profile_${e}`,s={...t,id:e,updatedAt:new Date().toISOString()};a.w.setItem(r,JSON.stringify(s));let n=await this.getAllUsers(),i=n.findIndex(t=>t.id===e);return i>=0&&(n[i]={...n[i],...s},a.w.setItem("users",JSON.stringify(n))),this.triggerEvent("profileUpdate",s),s}catch(e){throw console.error("Error updating student profile:",e),e}}getStudentProfile(e){let t=`profile_${e}`,r=a.w.getItem(t);return r?JSON.parse(r):null}async renewLibraryBook(e,t){try{let r=`libraryBooks_${t}`,s=a.w.getItem(r);if(s){let n=JSON.parse(s),i=n.findIndex(t=>t.id===e);if(i>=0){let s=new Date(n[i].dueDate);s.setDate(s.getDate()+14),n[i].dueDate=s.toISOString().split("T")[0],n[i].renewedAt=new Date().toISOString(),a.w.setItem(r,JSON.stringify(n)),this.triggerEvent("libraryBookRenewed",{bookId:e,studentId:t})}}return!0}catch(e){throw console.error("Error renewing library book:",e),e}}async submitAssignment(e){try{let t=`submissions_${e.studentId}`,r=a.w.getItem(t),s=r?JSON.parse(r):[],n=s.findIndex(t=>t.assignmentId===e.assignmentId);return n>=0?s[n]={...s[n],...e}:s.push({...e,id:Date.now().toString(),submittedAt:new Date().toISOString()}),a.w.setItem(t,JSON.stringify(s)),this.triggerEvent("assignmentSubmitted",e),e}catch(e){throw console.error("Error submitting assignment:",e),e}}async promoteStudent(e,t){try{let r=await this.getAllUsers(),s=r.findIndex(t=>t.id===e);return s>=0&&(r[s].class=t.toClass,r[s].session=t.session,r[s].promotedAt=t.promotedAt,a.w.setItem("users",JSON.stringify(r)),this.triggerEvent("studentPromoted",{studentId:e,promotionData:t})),!0}catch(e){throw console.error("Error promoting student:",e),e}}async saveBatchPromotion(e){try{let t=JSON.parse(a.w.getItem("batchPromotions")||"[]");return t.push(e),a.w.setItem("batchPromotions",JSON.stringify(t)),this.triggerEvent("batchPromotionCompleted",e),e}catch(e){throw console.error("Error saving batch promotion:",e),e}}}let n=s.getInstance()},7491:(e,t,r)=>{r.d(t,{w:()=>a});let a={getItem:()=>null,setItem:()=>{},removeItem:()=>{}}}};