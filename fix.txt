Fix for `npm run build` failing on Windows
========================================

1. Close every terminal that has a stale NODE_ENV value, then open a new **Command Prompt** (not PowerShell) and navigate to the project folder:

   ```cmd
   cd /d "C:\Users\Umar\Documents\UMAR MF\NEW vea-2025-main\vea-2025-main"
   ```

2. Make sure Next.js receives a standard production environment. Clear any global override that sets `NODE_ENV` to a non-standard value, then set it explicitly for the session before running the build:

   ```cmd
   set NODE_ENV=
   setx NODE_ENV production
   set NODE_ENV=production
   ```

   > You must close and reopen the terminal after running `setx` so the permanent value is picked up. When you reopen it, re-run the `cd` command from step 1; Windows prints the active `NODE_ENV` when you echo it:
   >
   > ```cmd
   > echo %NODE_ENV%
   > ```
   >
   > It must print exactly `production` (all lowercase).

3. Remove the old build artefacts that were generated with the wrong environment so Next.js can rebuild from scratch:

   ```cmd
   rmdir /s /q .next
   rmdir /s /q node_modules
   ```

4. Install a clean dependency tree and rebuild:

   ```cmd
   npm ci
   npm run build
   ```

   With `NODE_ENV=production`, the app pages are rendered with the correct runtime and the `GlobalLayoutRouterContext` error disappears.

5. Provide Next.js with a reachable MySQL database so the analytics probes do not throw `ECONNREFUSED`. You can start one quickly with Docker (Docker Desktop must be running):

   ```cmd
   docker run --name vea-mysql -p 3306:3306 -e MYSQL_DATABASE=vea_portal_2025 \
     -e MYSQL_USER=vea_admin -e MYSQL_PASSWORD="Himmacolage343#" \
     -e MYSQL_ROOT_PASSWORD="Himmacolage343#" -d mysql:8.0
   ```

   If you do not have Docker, start any MySQL 8.x server manually using the same credentials (database `vea_portal_2025`, user `vea_admin`, password `Himmacolage343#`).

6. Create or update the project `.env` file so Next.js knows how to reach the database. The `#` in the password must be URL encoded as `%23` in the connection string:

   ```env
   # .env
   NODE_ENV=production
   DATABASE_URL=mysql://vea_admin:Himmacolage343%23@127.0.0.1:3306/vea_portal_2025
   NEXT_PUBLIC_APP_URL=http://localhost:3000
   PAYSTACK_SECRET_KEY=your-paystack-secret
   ```

   Save the file with UTF-8 encoding. Re-run `npm run build` after setting up the database.

7. If you still see the `<Html> should not be imported outside of pages/_document` message, search the project for any accidental imports from `next/document` and remove them (they must only appear in `pages/_document.tsx`, which this app does not use). From Git Bash or WSL you can run:

   ```bash
   rg "next/document"
   ```

   Ensure every page (for example `app/500/page.tsx`, `app/not-found.tsx`, and `app/error.tsx`) only renders regular JSX (`<html>...</html>` tags supplied by the root layout) and does **not** import `Html`, `Head`, `Main`, or `NextScript`.

Following these steps produces a clean build on Windows without the runtime `useContext` crash, the `<Html>` runtime error, or the MySQL connection warnings.
